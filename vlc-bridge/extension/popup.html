<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="popup.css" />
</head>
<body>
  <div class="popup">

    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <rect x="2" y="2" width="20" height="20" rx="3" fill="var(--primary)" opacity="0.15" stroke="var(--primary)" stroke-width="1.2"/>
            <path d="M7 5h4a7 7 0 010 14H7V5z" fill="none" stroke="var(--primary)" stroke-width="1.5" stroke-linejoin="round"/>
            <polygon points="11,8.5 16,12 11,15.5" fill="var(--primary)"/>
          </svg>
        </div>
        <span class="header-title">DebridUI VLC</span>
      </div>
      <span class="status-badge" id="status-badge">
        <span class="status-dot" id="status-dot"></span>
        <span id="status-label">Checking</span>
      </span>
    </header>

    <!-- Player (visible when connected) -->
    <section id="player-section" class="section hidden">

      <!-- Now playing -->
      <div class="now-playing">
        <div class="np-art" id="np-art">
          <img id="np-art-img" class="np-art-img hidden" alt="" />
          <div class="np-icon-fallback">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v10.55A4 4 0 1014 17V7h4V3h-6z"/></svg>
          </div>
        </div>
        <div class="np-info">
          <p id="media-title" class="np-title">—</p>
          <div class="np-meta">
            <span id="media-state" class="np-state">Stopped</span>
            <span id="media-quality" class="np-quality hidden"></span>
          </div>
        </div>
      </div>

      <!-- Progress -->
      <div class="progress-container">
        <div class="progress-track" id="progress-track">
          <div class="progress-fill" id="progress-fill"></div>
          <div class="progress-thumb" id="progress-thumb"></div>
        </div>
        <div class="time-row">
          <span id="time-current">0:00</span>
          <span id="time-total">0:00</span>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="ctrl-btn" id="btn-prev" title="Previous">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
        </button>
        <button class="ctrl-btn" id="btn-rw" title="Rewind 10s">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
        </button>
        <button class="ctrl-btn ctrl-play" id="btn-play" title="Play / Pause">
          <svg id="icon-play" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="6,4 20,12 6,20"/></svg>
          <svg id="icon-pause" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="hidden"><rect x="5" y="4" width="4" height="16"/><rect x="15" y="4" width="4" height="16"/></svg>
        </button>
        <button class="ctrl-btn" id="btn-ff" title="Forward 10s">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.13-9.36L23 10"/></svg>
        </button>
        <button class="ctrl-btn" id="btn-next" title="Next">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
        </button>
        <button class="ctrl-btn" id="btn-fullscreen" title="Fullscreen">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>
        </button>
      </div>

      <!-- Volume -->
      <div class="volume-row">
        <button class="vol-btn" id="btn-mute" title="Mute">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3z"/><path d="M16.5 12A4.5 4.5 0 0014 8.18v7.64A4.49 4.49 0 0016.5 12zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
        </button>
        <input type="range" id="volume-slider" min="0" max="200" value="100" class="slider" />
        <span id="volume-label" class="vol-label">100%</span>
      </div>

      <!-- Track & Advanced controls (collapsible) -->
      <button class="panel-toggle" id="panel-toggle" title="Show track controls">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg>
        <span>Tracks &amp; Controls</span>
      </button>
      <div class="panel-content" id="panel-content">
        <div class="tracks" id="tracks-section">
          <div class="track-row">
            <label>Audio</label>
            <select id="select-audio"><option value="-1">Default</option></select>
          </div>
          <div class="track-row">
            <label>Subtitle</label>
            <select id="select-sub"><option value="-1">Disabled</option></select>
          </div>
          <div class="track-row">
            <label>Sub Delay</label>
            <div class="delay-controls">
              <button class="btn-delay" id="btn-sub-delay-minus" title="-0.5s (Shift: -0.1s)">-</button>
              <span class="delay-value" id="sub-delay-value">0.0s</span>
              <button class="btn-delay" id="btn-sub-delay-plus" title="+0.5s (Shift: +0.1s)">+</button>
              <button class="btn-delay btn-delay-reset" id="btn-sub-delay-reset" title="Reset to 0">↺</button>
            </div>
          </div>
          <div class="track-row">
            <label>Audio Delay</label>
            <div class="delay-controls">
              <button class="btn-delay" id="btn-audio-delay-minus" title="-0.5s (Shift: -0.1s)">-</button>
              <span class="delay-value" id="audio-delay-value">0.0s</span>
              <button class="btn-delay" id="btn-audio-delay-plus" title="+0.5s (Shift: +0.1s)">+</button>
              <button class="btn-delay btn-delay-reset" id="btn-audio-delay-reset" title="Reset to 0">↺</button>
            </div>
          </div>
          <div class="track-row">
            <label>Speed</label>
            <select id="select-speed">
              <option value="0.5">0.5x</option>
              <option value="0.75">0.75x</option>
              <option value="1" selected>1.0x</option>
              <option value="1.25">1.25x</option>
              <option value="1.5">1.5x</option>
              <option value="1.75">1.75x</option>
              <option value="2">2.0x</option>
            </select>
          </div>
        </div>

        <!-- Loop / Shuffle -->
        <div class="toggle-row">
          <button class="toggle-btn" id="btn-loop" title="Loop">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 014-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 01-4 4H3"/></svg>
            <span>Loop</span>
          </button>
          <button class="toggle-btn" id="btn-shuffle" title="Shuffle">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/><line x1="4" y1="4" x2="9" y2="9"/></svg>
            <span>Shuffle</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Disconnected state -->
    <section id="disconnected-section" class="section">
      <div class="empty-state">
        <div class="empty-icon">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none">
            <rect x="2" y="2" width="20" height="20" rx="3" fill="var(--primary)" opacity="0.12"/>
            <path d="M7 5h4a7 7 0 010 14H7V5z" fill="none" stroke="var(--primary)" stroke-width="1" opacity="0.4"/>
            <polygon points="11,8.5 16,12 11,15.5" fill="var(--primary)" opacity="0.3"/>
          </svg>
        </div>
        <p class="empty-title">VLC not connected</p>
        <p class="empty-desc">Enable VLC's HTTP interface to get started</p>
      </div>

      <details class="setup-details" id="setup-guide">
        <summary class="setup-toggle">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          Setup Guide
        </summary>
        <div class="setup-content">
          <div class="setup-method">
            <p class="setup-label">Option A — Permanent (recommended)</p>
            <ol class="setup-steps">
              <li>VLC → Tools → Preferences</li>
              <li>Bottom-left: Show settings → <strong>All</strong></li>
              <li>Interface → Main interfaces → check <strong>Web</strong></li>
              <li>Main interfaces → Lua → set password to <strong>vlcbridge</strong></li>
              <li>Save & restart VLC</li>
            </ol>
          </div>
          <div class="setup-divider"><span>or</span></div>
          <div class="setup-method">
            <p class="setup-label">Option B — Quick launch</p>
            <div class="setup-cmd">
              <code id="setup-cmd">vlc --extraintf http --http-password vlcbridge</code>
              <button class="btn-copy" id="btn-copy-cmd" title="Copy">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
              </button>
            </div>
          </div>
        </div>
      </details>
    </section>

    <!-- Actions -->
    <section class="section actions-section">
      <button class="btn-primary" id="btn-launch">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.13-9.36L23 10"/></svg>
        Retry Connection
      </button>

      <div class="url-input-group">
        <input type="text" id="input-url" placeholder="Paste media URL..." class="url-input" />
        <div class="url-actions">
          <button class="btn-sm" id="btn-play-url" title="Play URL">
            <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><polygon points="6,4 20,12 6,20"/></svg>
            Play
          </button>
          <button class="btn-sm btn-ghost" id="btn-sub-url" title="Load as subtitle">CC</button>
        </div>
      </div>
    </section>

    <!-- Settings -->
    <details class="settings-details">
      <summary class="settings-toggle">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
        Settings
      </summary>
      <div class="settings-form">
        <div class="field">
          <label for="input-port">Port</label>
          <input type="number" id="input-port" value="8080" />
        </div>
        <div class="field">
          <label for="input-password">Password</label>
          <div class="password-field">
            <input type="text" id="input-password" value="vlcbridge" />
            <button class="btn-icon" id="btn-toggle-pw" title="Toggle visibility">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>
        </div>
        <button class="btn-sm btn-save" id="btn-save">Save</button>
      </div>
    </details>

    <!-- Toast -->
    <div id="toast" class="toast hidden"></div>
  </div>
  <script src="popup.js"></script>
</body>
</html>
